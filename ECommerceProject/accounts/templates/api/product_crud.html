{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Product CRUD</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="p-4">

  <h2>Add New Product</h2>
  <form id="addProductForm">
    <input type="text" id="name" class="form-control mb-2" placeholder="Product Name">
    <input type="number" id="price" class="form-control mb-2" placeholder="Price">
    <button type="submit" class="btn btn-success">Add Product</button>
  </form>

  <hr>

  <h2>All Products</h2>
  <div id="productList"></div>

  <!-- Edit Form (hidden by default) -->
  <div id="editForm" style="display:none;">
    <h2>Edit Product</h2>
    <input type="text" id="editName" class="form-control mb-2">
    <input type="number" id="editPrice" class="form-control mb-2">
    <button onclick="updateProduct()" class="btn btn-warning">Update</button>
  </div>

  <script>
    const apiBase = '/api/products/';
    let currentEditId = null;

    function loadProducts() {
      fetch(apiBase)
        .then(res => res.json())
        .then(data => {
          let html = '';
          data.forEach(product => {
            html += `
              <div class="border p-3 my-2">
                <strong>${product.name}</strong> - $${product.price}
                <button onclick="editProduct(${product.id}, '${product.name}', ${product.price})" class="btn btn-sm btn-warning ms-2">Edit</button>
                <button onclick="deleteProduct(${product.id})" class="btn btn-sm btn-danger ms-2">Delete</button>
              </div>`;
          });
          document.getElementById('productList').innerHTML = html;
        });
    }

    document.getElementById('addProductForm').addEventListener('submit', function (e) {
      e.preventDefault();
      const name = document.getElementById('name').value;
      const price = document.getElementById('price').value;

      fetch(apiBase, {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({ name, price })
      })
      .then(res => res.json())
      .then(() => {
        loadProducts();
        this.reset();
      });
    });

    function editProduct(id, name, price) {
      currentEditId = id;
      document.getElementById('editName').value = name;
      document.getElementById('editPrice').value = price;
      document.getElementById('editForm').style.display = 'block';
    }

    function updateProduct() {
      const name = document.getElementById('editName').value;
      const price = document.getElementById('editPrice').value;

      fetch(apiBase + currentEditId + '/', {
        method: 'PUT',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({ name, price })
      })
      .then(() => {
        loadProducts();
        document.getElementById('editForm').style.display = 'none';
      });
    }

    function deleteProduct(id) {
      if (!confirm('Delete this product?')) return;
      fetch(apiBase + id + '/', { method: 'DELETE' })
        .then(() => loadProducts());
    }

    loadProducts();
  </script>
</body>
</html>
