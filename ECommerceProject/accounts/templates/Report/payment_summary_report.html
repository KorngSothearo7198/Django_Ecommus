{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>üßæ Payment Summary Report</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    h2 {
      font-weight: bold;
      color: #2c3e50;
    }

    .table-responsive {
      background: white;
      padding: 1rem;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    @media print {
      #print-button {
        display: none;
      }
      body {
        background: white !important;
      }
    }
  </style>
</head>
<body class="bg-light">
  <div class="container py-5">
    <h2 class="mb-4 text-center">üßæ Payment Summary Report</h2>
    <button id="print-button" class="btn btn-primary mb-3">üñ®Ô∏è Print Report</button>

    <div class="table-responsive">
      <table class="table table-bordered table-striped align-middle" id="payment-summary-table">
        <thead class="table-dark">
          <tr>
            <th>#</th>
            <th>Cart ID</th>
            <th>User</th>
            <th>Payment Method</th>
            <th>Amount ($)</th>
            <th>Status</th>
            <th>Date</th>
          </tr>
        </thead>
        <tbody>
          <tr><td colspan="7" class="text-center text-muted">Loading...</td></tr>
        </tbody>
      </table>
    </div>
  </div>

  <script>
    document.getElementById("print-button").onclick = () => window.print();

    fetch('/api/payment-summary-report/')
      .then(res => res.json())
      .then(data => {
        const tbody = document.querySelector("#payment-summary-table tbody");
        if (data.length === 0) {
          tbody.innerHTML = `<tr><td colspan="7" class="text-center text-muted">No data found.</td></tr>`;
          return;
        }

        tbody.innerHTML = "";
        data.forEach((item, index) => {
          const userDisplay = item.user ? `${item.user.username} (${item.user.email})` : "Guest";
          const row = `
            <tr>
              <td>${index + 1}</td>
              <td>${item.cart}</td>
              <td>${userDisplay}</td>
              <td>${item.payment_method}</td>
              <td>${parseFloat(item.amount).toFixed(2)}</td>
              <td>${item.status}</td>
              <td>${new Date(item.payment_date).toLocaleString()}</td>
            </tr>
          `;
          tbody.innerHTML += row;
        });
      })
      .catch(err => {
        console.error("Error loading payment summary:", err);
        document.querySelector("#payment-summary-table tbody").innerHTML =
          `<tr><td colspan="7" class="text-danger text-center">Failed to load data.</td></tr>`;
      });
  </script>
</body>
</html>
