<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Report Order</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    .print-btn {
      float: right;
    }
  </style>
</head>

<body>
  <div class="container my-4">
    <h3>üßæ Report Order</h3>

    <!-- Filter Section -->
    <div class="row my-4">
      <div class="col-md-3">
        <label for="startDate" class="form-label">Start Date</label>
        <input type="date" id="startDate" class="form-control" />
      </div>
      <div class="col-md-3">
        <label for="endDate" class="form-label">End Date</label>
        <input type="date" id="endDate" class="form-control" />
      </div>
      <div class="col-md-3">
        <label for="timeRange" class="form-label">Time of Day</label>
        <select id="timeRange" class="form-select">
          <option value="">All</option>
          <option value="morning">Morning (00:00-11:59)</option>
          <option value="afternoon">Afternoon (12:00-17:59)</option>
          <option value="evening">Evening (18:00-23:59)</option>
        </select>
      </div>
      <div class="col-md-3 d-flex align-items-end">
        <button onclick="fetchAllOrders()" class="btn btn-success w-100">üîç Filter</button>
      </div>
    </div>


    <button class="btn btn-primary print-btn" onclick="window.print()">üñ®Ô∏è Print Report</button>
    <table class="table table-bordered mt-3">
      <thead class="table-light">
        <tr>
          <th>Order ID</th>
          <th>Customer</th>
          <th>Phone</th>
          <th>Date</th>
          <th>Total</th>
          <th>QR</th>
          <th>Payment Method</th> 
          <th>Items</th>
        </tr>
      </thead>
      <tbody id="orderReportBody"></tbody>
    </table>
  </div>

  <script>


    function fetchAllOrders() {
      const startDate = document.getElementById('startDate').value;
      const endDate = document.getElementById('endDate').value;
      const timeRange = document.getElementById('timeRange').value;

      // Build query params for filtering
      const params = new URLSearchParams();

      if (startDate) params.append('start_date', startDate);
      if (endDate) params.append('end_date', endDate);
      if (timeRange) params.append('time_range', timeRange);

      const token = localStorage.getItem('authToken'); // Or wherever your token is stored


      if (token) params.append('token', token);

      fetch('/api/orders/' + params.toString())

        .then(res => {
          if (!res.ok) {
            throw new Error(`HTTP ${res.status}`);
          }
          return res.json();
        })
        .then(data => {
          const tbody = document.getElementById('orderReportBody');
          tbody.innerHTML = '';
          data.forEach(order => {
            const itemList = order.items.map(i =>
              `<li>${i.productName || 'N/A'} - ${i.quantity} x $${i.price} = $${(i.quantity * i.price).toFixed(2)}</li>`
            ).join('');

            tbody.innerHTML += `
                            <tr>
                                <td>#${order.id}</td>
                                <td>${order.customerName}</td>
                                <td>${order.customerPhone}</td>
                                <td>${new Date(order.orderDate).toLocaleString()}</td>
                                <td>$${parseFloat(order.totalAmount).toFixed(2)}</td>
                                <td>${order.QRCodeInvoice ? `<img src="${order.QRCodeInvoice}" width="60">` : '‚Äî'}</td>
                                <td>${order.paymentMethod || '‚Äî'}</td>
                                <td><ul class="mb-0">${itemList}</ul></td>
                            </tr>
                        `;
          });
        })
        .catch(err => {
          document.getElementById('orderReportBody').innerHTML = `
                        <tr><td colspan="8" class="text-danger">‚ö†Ô∏è Cannot load orders: ${err}</td></tr>
                    `;
        });
    }

    // Init when page loads
    window.addEventListener('DOMContentLoaded', fetchAllOrders);
  </script>
</body>

</html>



<!-- 
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <title>Report Order</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <style>
    .print-btn {
      float: right;
    }
    ul {
      margin: 0;
      padding-left: 1rem;
    }
  </style>
</head>

<body>
  <div class="container my-4">
    <h3>üßæ Report Order</h3>
    <button class="btn btn-primary print-btn" onclick="window.print()">üñ®Ô∏è Print Report</button>
    <table class="table table-bordered mt-3">
      <thead class="table-light">
        <tr>
          <th>Cart ID</th>
          <th>User</th>
          <th>Created</th>
          <th>Total</th>
          <th>Items</th>
          <th>Payments</th>
        </tr>
      </thead>
      <tbody id="orderReportBody"></tbody>
    </table>
  </div>

  <script>
    function fetchAllOrders() {
      fetch('/api/carts/')
        .then(res => {
          if (!res.ok) throw new Error(`HTTP ${res.status}`);
          return res.json();
        })
        .then(data => {
          const tbody = document.getElementById('orderReportBody');
          tbody.innerHTML = '';
          data.forEach(cart => {
            const itemList = cart.items.map(item =>
              `<li>${item.product_name} - Qty: ${item.quantity} - $${item.total_price}</li>`
            ).join('');

            const paymentList = cart.payments.length > 0
              ? cart.payments.map(p =>
                `<li>$${p.amount} (${p.payment_method}) - ${p.status} on ${new Date(p.payment_date).toLocaleString()}</li>`
              ).join('')
              : '<li>No payments</li>';

            tbody.innerHTML += `
              <tr>
                <td>#${cart.id}</td>
                <td>${cart.user || 'Guest'}</td>
                <td>${new Date(cart.created_at).toLocaleString()}</td>
                <td>$${cart.total_amount}</td>
                <td><ul>${itemList}</ul></td>
                <td><ul>${paymentList}</ul></td>
              </tr>
            `;
          });
        })
        .catch(err => {
          document.getElementById('orderReportBody').innerHTML = `
            <tr><td colspan="6" class="text-danger">‚ö†Ô∏è Cannot load carts: ${err}</td></tr>
          `;
        });
    }

    // Load when page is ready
    window.addEventListener('DOMContentLoaded', fetchAllOrders);
  </script>
</body>

</html> -->